// Generated by CoffeeScript 1.6.3
(function() {
  jQuery(function($) {
    var username;
    username = ($("body")).data("username" != null ? "username" : null);
    if (username) {
      console.log("Logged in as " + username);
    } else {
      console.log("Not logged in (yet?)");
    }
    navigator.id.watch({
      loggedInUser: username,
      onlogin: function(assertion) {
        console.log("Logging in...");
        return $.ajax({
          type: "POST",
          url: "/auth/login",
          data: {
            assertion: assertion
          },
          success: function() {
            return window.location.reload();
          },
          error: function(xhr, status, error) {
            console.dir(xhr);
            return navigator.id.logout();
          }
        });
      },
      onlogout: function() {
        console.log("Logging out...");
        return $.ajax({
          type: "POST",
          url: "/auth/logout",
          success: function() {
            return window.location.reload();
          },
          error: function(xhr, status, error) {
            return console.error("Logout failed: " + error);
          }
        });
      }
    });
    ($("a[data-signin]")).click(function() {
      return navigator.id.request();
    });
    return ($("a[data-signout]")).click(function() {
      return navigator.id.logout();
    });
  });

}).call(this);

/*
//@ sourceMappingURL=persona.map
*/
